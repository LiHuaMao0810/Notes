# Relation Model 关系模型

[TOC]



## 1 Structure of Relational Databases

### 1.1 Concepts

​	虽然数据库看起来是表格的形式，有第一行第二行的差别，但是实际上数据库是一堆关系的集合，一个元组就是一个关系，集合是无序的。



### 1.2 Attributes 属性

* domain（定义域）​：允许的值的范围
* atomic（原子性）：属性一般是原子性的，即不可再分的
* null：空值是允许的



## 2 Database Schema



- **Database schema** -- is the logical structure of the database. 数据库的逻辑结构，不同表之间如何引用等
- **Database instance** -- is a snapshot of the data in the database at a given instant in time. 数据库实例，即当前数据的快照

<details>
    <summary>Example</summary>
    <img src = "http://cdn.hobbitqia.cc/202303061658549.png" alt = "img" />
</details>




## 3 Keys

* **superkey（超键）**：**K** is a **superkey (超键)** of  **R ** if values for K are sufficient to identify (唯一确定) a unique tuple of each possible relation  超键能唯一确定一个元组

* **candidate key (候选键)** : **K** **Superkey**  is a **candidate key (候选键)** if **K** is minimal.
   即 **K** 中没有冗余属性  

* **primary key（主键）**：One of the candidate keys is selected to be the **primary key**

​	选择一个候选键作为主键

* **foreign key（外键）**：引用外部表格的键，比如课程的table中有教师名字这一项，那么教师的名字应该引用自教师instructor的table，所以是外键。instructor里面必须有这个教师的名字，课程的授课教师才能使用这个名字，否则这个值是非法invalid的，这是一种完整性约束条件。



## 4 Relation Algebra 关系代数

### 4.1 Basic Operators

1. Select : 按照条件选择元组
2. Project ： 投影，选择某几列
3. Union：取交集
4. Set Difference：集合减法，A-B是去掉A中有B属性的部分
5. Cartesian-Product：笛卡尔积，将两个表格中各取一个元组两两组合构成新表
6. Rename = n：重命名

### 4.2 Addtional Operator

基本操作组合形成的衍生操作，并没有增加关系代数的查询能力，只是方便书写sql语句

1. Set Intersection：取交集
2. Natural Join：当两个表有同名属性的时候，**R** natural join **S** 就是两个表做笛卡尔积，并且取出同名属性相同的元组形成新的表，并且将同名属性合并（注意，如果两个同名属性意义不同，可以做这个操作但是没有实际意义）

*e.g* **select**  instructor.name = course.teacher_name (instuctor x course.teacher_name)

3.  Semijoin：保留r中能和s相连的元组

| 类型                | 描述                                                         |
| ------------------- | ------------------------------------------------------------ |
| **INNER JOIN**      | 返回两个表中满足连接条件的记录（交集）。                     |
| **LEFT JOIN**       | 返回左表中的所有记录，即使右表中没有匹配的记录（保留左表）。 |
| **RIGHT JOIN**      | 返回右表中的所有记录，即使左表中没有匹配的记录（保留右表）。 |
| **FULL OUTER JOIN** | 返回两个表的并集，包含匹配和不匹配的记录。                   |
| **CROSS JOIN**      | 返回两个表的笛卡尔积，每条左表记录与每条右表记录进行组合。   |
| **SELF JOIN**       | 将一个表与自身连接。                                         |
| **NATURAL JOIN**    | 基于同名字段自动匹配连接的表。                               |

4. Division：r ÷ s ， 返回最大的table t  ，满足 t x s 是r的子集。



### 4.3 Aggregate Fuctions and Operations

**Aggregation function**（聚合函数）takes a collection of values and returns a single value as a result.  

- *avg*: average value
- *min*: minimum value
- *max*: maximum value
- *sum*: sum of values
- *count*: number of values